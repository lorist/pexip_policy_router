{% extends "policy_router/base.html" %}

{% block content %}
<div class="container mt-4">
  <h2>Policy Proxy Rules</h2>

  <div class="mb-3">
    <a href="{% url 'policy_router:rule_create' %}" class="btn btn-success">Create New Rule</a>
  </div>

  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th>Name</th>
        <th>Local Alias Regex</th>
        <th>Service Target</th>
        <th>Participant Target</th>
        <th>Priority</th>
        <th>Status</th>
        <th>Overrides</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for rule in rules %}
      <tr>
        <td>{{ rule.name }}</td>
        <td><code>{{ rule.regex }}</code></td>
        <td>{{ rule.service_target_url }}</td>
        <td>{{ rule.participant_target_url }}</td>
        <td>{{ rule.priority }}</td>
        <td>
          {% if rule.is_active %}
            <span class="badge bg-success">Active</span>
          {% else %}
            <span class="badge bg-secondary">Inactive</span>
          {% endif %}
        </td>
        <td>
          {% if rule.always_continue_service %}
            <span class="badge bg-primary">Service Override</span>
          {% endif %}
          {% if rule.always_continue_participant %}
            <span class="badge bg-info">Participant Override</span>
          {% endif %}
        </td>
        <td>
          <a href="{% url 'policy_router:rule_edit' rule.pk %}" class="btn btn-sm btn-warning">Edit</a>
          <a href="{% url 'policy_router:rule_delete' rule.pk %}" class="btn btn-sm btn-danger">Delete</a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="8" class="text-center text-muted">No rules defined.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
